var l=(o,n,r)=>new Promise((i,m)=>{var C=d=>{try{y(r.next(d))}catch(x){m(x)}},h=d=>{try{y(r.throw(d))}catch(x){m(x)}},y=d=>d.done?i(d.value):Promise.resolve(d.value).then(C,h);y((r=r.apply(o,n)).next())});import{U as $,ar as N,aE as V,O as v,a6 as D,V as z,a3 as M,a5 as O,ad as w,aj as b,ap as e,m as g,a9 as c,aw as _,af as Q,am as F,F as G,ax as H,b1 as K}from"../jse/index-index-QIcGCnph.js";import{Q as P}from"./browser-D_yyu_vO.js";import{aJ as k,aK as L,aH as W}from"./bootstrap-eRMf25wG.js";import{_ as A}from"./avatar.vue_vue_type_script_setup_true_lang-DWiYZY0v.js";import{_ as J,a as X}from"./CardContent.vue_vue_type_script_setup_true_lang-XW_jhSyo.js";import{u as Y,a as Z}from"./use-modal-CTmlTAk4.js";function ee(o){return l(this,null,function*(){return k.get(`/tool/${o.slug}/qr-key`)})}function te(o){return l(this,null,function*(){return k.post("/tool/qr-login-status",o)})}function oe(o){return l(this,null,function*(){return k.put("/tool/update-cookie-status",o)})}function se(o){return l(this,null,function*(){return k.get(`/tool/${o.slug}/state`)})}function ae(o){return l(this,null,function*(){return k.put("/tool/update-tool-status",o)})}const le=typeof window!="undefined"&&typeof document!="undefined";typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;const ne=()=>{};function re(...o){if(o.length!==1)return $(...o);const n=o[0];return typeof n=="function"?N(V(()=>({get:n,set:ne}))):v(n)}function ie(o,n){const r=re(o),i=D("");return z(r,m=>l(this,null,function*(){r.value&&le&&(i.value=yield P.toDataURL(m,n))}),{immediate:!0}),i}const ce={class:"flex flex-col p-5 lg:flex-row"},de={class:"mr-4 w-full lg:w-2/5"},ue={class:"card-box flex flex-col items-center p-4 py-6"},fe={class:"mt-2 flex flex-col justify-center"},pe={class:"text-md text-center text-xl font-semibold"},ge={class:"mt-2 flex"},me={class:"flex"},_e={key:0,class:"text-green-500"},ve={key:1,class:"text-red-500"},he={class:"ml-5 flex"},ye={class:"mt-4 flex"},xe={class:"flex-col-center mt-6"},we=["src"],be={class:"mt-5 w-full lg:ml-0 lg:mt-0 lg:w-3/5"},ke={class:"mb-1 flex justify-center"},Ce={class:"mt-2"},Ie={class:"text-md text-center text-xl"},Qe={class:"text-foreground/80 mt-1 text-left"},Se={class:"flex justify-between"},Te={class:"flex"},qe={class:"ml-4 text-lg font-medium"},Ue={class:"text-foreground/80 mt-4 flex h-10"},Le={class:"text-foreground/80 flex justify-between"},Ve=M({name:"Tool",__name:"tool",props:{slug:{default:"qq-music"},avatarUrl:{default:"https://q.qlogo.cn/headimg_dl?dst_uin=2609682329&spec=640&img_type=jpg"},group:{default:"QQ音乐·测试组"},toolTitle:{default:"QQ音乐工具"},toolDescription:{default:"自动听歌、签到、任务管理等功能合集"}},setup(o){const n=o,r=v([]),i=v(null),m=v("https://tool.osyb.cn"),C=v(""),h=v(!1);function y(){return l(this,null,function*(){const s=yield se({slug:n.slug});i.value=s.toolState,r.value=s.availableTools})}y();function d(s){return l(this,null,function*(){h.value=!0;try{yield oe({slug:n.slug,enabled:s}),i.value.cookieStatus.autoUpdateEnabled=s}catch(t){console.error("自动更新状态修改失败:",t)}finally{h.value=!1}})}function x(s,t){return l(this,null,function*(){if(t===void 0)return;const a=r.value[t];a.loading=!0;try{yield ae({toolId:a.toolId,enabled:s}),a.isToolEnabled=s}catch(p){console.error("工具状态更新失败:",p)}finally{a.loading=!1}})}let u;const{refresh:R}=Y(),[B,T]=Z({footer:!1,onOpenChange:s=>l(this,null,function*(){try{if(s){const t=()=>l(this,null,function*(){try{const a=yield ee({slug:n.slug});a.type===2?m.value=atob(a.img_base64):C.value=a.img_base64,u=setInterval(()=>l(this,null,function*(){try{const p={slug:n.slug,key:a.key,field_1:a.field_1};switch((yield te(p)).status){case"canceled":case"unknown":{clearInterval(u),yield t();break}case"success":{T.close(),clearInterval(u),R();break}}}catch(p){console.error("检查登录状态失败:",p),clearInterval(u)}}),5e3)}catch(a){console.error("获取二维码失败:",a),clearInterval(u)}});yield t()}else clearInterval(u)}catch(t){console.error("QqMusicQrLoginApi 调用失败:",t),clearInterval(u)}})}),j=ie(m,{errorCorrectionLevel:"H",margin:4});return O(()=>{u&&clearInterval(u)}),(s,t)=>{var a,p,S,q,U;return w(),b("div",ce,[e("div",de,[e("div",ue,[g(c(A),{src:((a=i.value)==null?void 0:a.toolProfileInfo.avatarUrl)||s.avatarUrl,class:"size-20"},null,8,["src"]),e("div",fe,[e("div",pe," 名称："+_((S=(p=i.value)==null?void 0:p.toolProfileInfo.profileName)!=null?S:"未登录"),1)]),e("div",ge,[e("div",me,[t[2]||(t[2]=e("span",null,"Cookie：",-1)),(q=i.value)!=null&&q.cookieStatus.cookieValid?(w(),b("div",_e," 正常 ")):(w(),b("span",ve,"异常"))]),e("div",he,[t[3]||(t[3]=e("span",null,"自动更新：",-1)),g(c(L),{checked:(U=i.value)==null?void 0:U.cookieStatus.autoUpdateEnabled,loading:h.value,onChange:t[0]||(t[0]=f=>d(!!f))},null,8,["checked","loading"])])]),e("div",ye,[g(c(W),{type:"primary",onClick:t[1]||(t[1]=()=>c(T).open())},{default:Q(()=>t[4]||(t[4]=[F(" 扫码登录 ")])),_:1}),g(c(B),{class:"w-[600px]",title:"扫码登录"},{default:Q(()=>[e("div",xe,[e("img",{src:C.value||c(j),alt:"qrcode",class:"w-1/2"},null,8,we)]),t[5]||(t[5]=e("div",{class:"mt-4 text-center"},[e("span",null,"请使用 QQ 扫码登录")],-1))]),_:1})])])]),e("div",be,[g(c(X),null,{default:Q(()=>[e("div",ke,[e("div",Ce,[e("div",Ie,_(s.toolTitle),1),e("span",Qe,_(s.toolDescription),1)])]),g(c(J),{class:"flex flex-wrap p-0"},{default:Q(()=>[(w(!0),b(G,null,H(r.value,(f,I)=>(w(),b("div",{key:f.toolId,class:K([{"border-r-0":I%3===2,"border-b-0":I<3,"pb-4":I>2},"border-border group w-full cursor-pointer border-r border-t p-4 transition-all hover:shadow-xl md:w-1/2 lg:w-1/3"])},[e("div",Se,[e("div",Te,[g(c(A),{src:f.iconUrl,class:"size-8 transition-all duration-300 group-hover:scale-110"},null,8,["src"]),e("span",qe,_(f.toolName),1)]),g(c(L),{checked:f.isToolEnabled,loading:f.loading,onChange:E=>x(!!E,I)},null,8,["checked","loading","onChange"])]),e("div",Ue,_(f.description),1),e("div",Le,[e("span",null,_(s.group),1),e("span",null,_(f.updatedAt),1)])],2))),128))]),_:1})]),_:1})])])}}});export{Ve as _};
