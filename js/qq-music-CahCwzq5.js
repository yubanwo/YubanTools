var f=(s,r,o)=>new Promise((i,l)=>{var m=a=>{try{t(o.next(a))}catch(q){l(q)}},e=a=>{try{t(o.throw(a))}catch(q){l(q)}},t=a=>a.done?i(a.value):Promise.resolve(a.value).then(m,e);t((o=o.apply(s,r)).next())});import{aU as L,u as w,$ as g,d as T,aJ as $,e as h,L as B}from"./bootstrap-eRMf25wG.js";import{u as P}from"./useQRCode-BQ0LgQ9u.js";import{ad as k,aj as v,ap as d,ag as c,a3 as x,O as b,m as y,af as _,a9 as n,am as u,aw as p,a4 as Q,a5 as C,ae as I}from"../jse/index-index-QIcGCnph.js";import"./browser-D_yyu_vO.js";const S={},F={class:"flex-col-center sm:mx-auto sm:w-full sm:max-w-md"},N={class:"text-foreground mb-3 text-3xl font-bold leading-9 tracking-tight lg:text-4xl"},A={class:"text-muted-foreground lg:text-md mb-1 text-sm"},R={class:"text-muted-foreground lg:text-md text-sm"};function V(s,r){return k(),v("div",F,[d("h3",N,[c(s.$slots,"default")]),d("p",A,[c(s.$slots,"desc")]),d("p",R,[c(s.$slots,"desc-bottom")])])}const E=L(S,[["render",V]]),H={class:"flex-col-center"},K=["src"],M={class:"text-muted-foreground mt-4 text-sm"},O=x({name:"FreeQQMusic",__name:"free-qq-music",props:{loading:{type:Boolean,default:!1},loginPath:{default:"/auth/login"},title:{default:""},subTitle:{default:""},bottomTitle:{default:""},submitButtonText:{default:""},description:{default:""},qrLoginPath:{default:"https://tool.osyb.cn"},qrLoginBase64:{default:""},qrLoginKey:{default:""},qrLoginKeyPath:{default:""}},setup(s){const r=s,o=w(),i=b(r.qrLoginPath),l=P(i,{errorCorrectionLevel:"H",margin:4});function m(){o.push(r.loginPath)}return(e,t)=>(k(),v("div",null,[y(E,null,{desc:_(()=>[c(e.$slots,"subTitle",{},()=>[u(p(e.subTitle||n(g)("authentication.qrcodeSubtitle")),1)])]),"desc-bottom":_(()=>[c(e.$slots,"bottomTitle",{},()=>[u(p(e.bottomTitle||n(g)("authentication.qrcodeSubtitle")),1)])]),default:_(()=>[c(e.$slots,"title",{},()=>[u(p(e.title||n(g)("authentication.welcomeBack")),1)])]),_:3}),d("div",H,[d("img",{src:e.qrLoginBase64||n(l),alt:"qrcode",class:"w-1/2"},null,8,K),d("p",M,[c(e.$slots,"description",{},()=>[u(p(e.description||n(g)("authentication.qrcodePrompt")),1)])])]),y(n(T),{class:"mt-4 w-full",variant:"outline",onClick:t[0]||(t[0]=a=>m())},{default:_(()=>[u(p(n(g)("common.back")),1)]),_:1})]))}});function U(s){return f(this,null,function*(){return $.get(`/free/${s.slug}/qr-key`)})}function j(s){return f(this,null,function*(){return $.post("/free/qr-login-status",s)})}const X=x({name:"Free",__name:"qq-music",setup(s){const r=b(""),o=b("");let i;function l(){return f(this,null,function*(){try{const t=yield U({slug:"qq-music"});r.value=t.img_base64,o.value=t.key,m()}catch(t){console.error("Error fetching QR code:",t),h.error({duration:3,description:"未知错误，请稍后重试",message:"获取二维码失败"})}})}function m(){i=setInterval(()=>f(this,null,function*(){if(!o.value){clearInterval(i);return}try{switch((yield j({slug:"qq-music",key:o.value,field_1:""})).status){case"canceled":{h.warning({duration:3,description:"登录已取消，请重新扫码",message:"登录失败"}),e(),l();break}case"expired":{h.warning({duration:3,description:"二维码已过期，正在刷新中...",message:"登录失败"}),e(),l();break}case"success":{h.success({duration:3,description:"领取成功，请稍后查看",message:"登录成功"}),e();break}}}catch(t){console.error("登录状态检查错误:",t),e()}}),3e3)}function e(){i&&clearInterval(i)}return Q(()=>{l()}),C(()=>{e()}),(t,a)=>(k(),I(n(O),{"login-path":n(B),"qr-login-base64":r.value,"qr-login-key":o.value,"bottom-title":"自带不能领取",description:"扫码登录后，自动领取3天豪华绿钻","sub-title":"请使用手机QQ扫码登录",title:"QQ音乐-领取3天豪华绿钻"},{default:_(()=>a[0]||(a[0]=[u(" /> ")])),_:1},8,["login-path","qr-login-base64","qr-login-key"]))}});export{X as default};
